<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Prescribed motions · Multibody.jl</title><meta name="title" content="Prescribed motions · Multibody.jl"/><meta property="og:title" content="Prescribed motions · Multibody.jl"/><meta property="twitter:title" content="Prescribed motions · Multibody.jl"/><meta name="description" content="Documentation for Multibody.jl."/><meta property="og:description" content="Documentation for Multibody.jl."/><meta property="twitter:description" content="Documentation for Multibody.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Multibody.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../pendulum/">Getting started: Pendulum</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../spring_damper_system/">Spring-damper system</a></li><li><a class="tocitem" href="../spring_mass_system/">Spring-mass system</a></li><li><a class="tocitem" href="../three_springs/">Three springs (series forces)</a></li><li><a class="tocitem" href="../sensors/">Sensors</a></li><li><a class="tocitem" href="../spherical_pendulum/">Spherical pendulum</a></li><li><a class="tocitem" href="../gearbox/">Gearbox</a></li><li><a class="tocitem" href="../free_motion/">Free motions</a></li><li class="is-active"><a class="tocitem" href>Prescribed motions</a></li><li><a class="tocitem" href="../kinematic_loops/">Kinematic loops</a></li><li><a class="tocitem" href="../robot/">Industrial robot</a></li><li><a class="tocitem" href="../ropes_and_cables/">Ropes, cables and chains</a></li><li><a class="tocitem" href="../swing/">Swing</a></li><li><a class="tocitem" href="../space/">Bodies in space</a></li><li><a class="tocitem" href="../gyroscopic_effects/">Gyroscopic effects</a></li><li><a class="tocitem" href="../wheel/">Wheels</a></li><li><a class="tocitem" href="../suspension/">Suspension systems</a></li><li><a class="tocitem" href="../quad/">Quadrotor with cable-suspended load</a></li></ul></li><li><span class="tocitem">Components</span><ul><li><a class="tocitem" href="../../frames/">Frames</a></li><li><a class="tocitem" href="../../joints/">Joints</a></li><li><a class="tocitem" href="../../components/">Components</a></li><li><a class="tocitem" href="../../forces/">Forces</a></li><li><a class="tocitem" href="../../sensors/">Sensors</a></li><li><a class="tocitem" href="../../trajectory_planning/">Trajectory planning</a></li><li><a class="tocitem" href="../../interfaces/">Interfaces</a></li></ul></li><li><a class="tocitem" href="../../rotations/">Rotations and orientation</a></li><li><a class="tocitem" href="../../rendering/">3D rendering</a></li><li><a class="tocitem" href="../../urdf/">URDF import</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Prescribed motions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Prescribed motions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaComputing/Multibody.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Prescribed-movements"><a class="docs-heading-anchor" href="#Prescribed-movements">Prescribed movements</a><a id="Prescribed-movements-1"></a><a class="docs-heading-anchor-permalink" href="#Prescribed-movements" title="Permalink"></a></h1><p>The movement of a frame can be prescribed using any of the components</p><ul><li><a href="../../components/#Multibody.Position-Tuple{}"><code>Position</code></a></li><li><a href="../../components/#Multibody.Pose-Tuple{}"><code>Pose</code></a></li></ul><p>The motion of joints <a href="../../joints/#Multibody.Revolute-Tuple{}"><code>Revolute</code></a> and <a href="../../joints/#Multibody.Prismatic-Tuple{}"><code>Prismatic</code></a> can also be prescribed by using <code>axisflange = true</code> and attaching a <code>ModelingToolkitStandardLibrary.Rotational.Position</code> or <code>ModelingToolkitStandardLibrary.TranslationalModelica.Position</code> to the axis flange of the joint.</p><p>Prescribed motions can be useful to, e.g.,</p><ul><li>Use the 3D rendering capabilities to visualize the movement of a mechanism moving in a prescribed way without simulating the system.</li><li>Simplify simulations by prescribing the movement of a part of the mechanism. </li></ul><p>In the example below, we prescribe the motion of a suspension system using <a href="../../components/#Multibody.Pose-Tuple{}"><code>Pose</code></a>. We load the <code>Rotations</code> package in order to get access to the constructor <code>RotXYZ</code> which allows us to specify a rotation matrix using Euler angles. The component prescribing the motion is</p><pre><code class="language-julia hljs">body_upright = Pose(; r = [0, 0.17 + 0.1sin(t), 0], R = RotXYZ(0, 0.5sin(t), 0))</code></pre><p>This makes the <code>body_upright</code> frame move in the vertical direction and rotate around the y-axis. Notice how the reference translation <code>r</code> and the reference orientation <code>R</code> are symbolic expressions that depend on time <code>t</code>. To make a frame follow recorded data, you may use <a href="https://docs.sciml.ai/DataInterpolations/stable/">DataInterpolations.jl</a> to create interpolation objects that when accessed with <code>t</code> return the desired position and orientation.</p><pre><code class="language-julia hljs">using Multibody
using Multibody.Rotations # To specify orientations using Euler angles
using ModelingToolkit
using Plots
using OrdinaryDiffEq
using LinearAlgebra
using JuliaSimCompiler
using Test

t = Multibody.t
D = Differential(t)


n = [1, 0, 0]
AB = 146.5 / 1000
BC = 233.84 / 1000
CD = 228.60 / 1000
DA = 221.43 / 1000
BP = 129.03 / 1000
DE = 310.31 / 1000
t5 = 19.84 |&gt; deg2rad

@mtkmodel QuarterCarSuspension begin
    @structural_parameters begin
        spring = true
        (jc = [0.5, 0.5, 0.5, 0.7])#, [description = &quot;Joint color&quot;]
        mirror = false
    end
    @parameters begin
        cs = 4000, [description = &quot;Damping constant [Ns/m]&quot;]
        ks = 44000, [description = &quot;Spring constant [N/m]&quot;]
        rod_radius = 0.02
        jr = 0.03, [description = &quot;Radius of revolute joint&quot;]
    end
    begin
        dir = mirror ? -1 : 1
        rRod1_ia = AB*normalize([0, -0.1, 0.2dir])
        rRod2_ib = BC*normalize([0, 0.2, 0dir])
    end
    @components begin
        r123 = JointRRR(n_a = n*dir, n_b = n*dir, rRod1_ia, rRod2_ib, rod_radius=0.018, rod_color=jc)
        r2 = Revolute(; n=n*dir, radius=jr, color=jc)
        b1 = FixedTranslation(radius = rod_radius, r = CD*normalize([0, -0.1, 0.3dir])) # CD
        chassis = FixedTranslation(r = DA*normalize([0, 0.2, 0.2*sin(t5)*dir]), render=false)
        chassis_frame = Frame()

        if spring
            springdamper = SpringDamperParallel(c = ks, d = cs, s_unstretched = 1.3*BC, radius=rod_radius, num_windings=10)
        end
        if spring
            spring_mount_F = FixedTranslation(r = 0.7*CD*normalize([0, -0.1, 0.3dir]), render=false)
        end
        if spring
            spring_mount_E = FixedTranslation(r = 1.3DA*normalize([0, 0.2, 0.2*sin(t5)*dir]), render=true)
        end
    end
    begin
        A = chassis.frame_b
        D = chassis.frame_a
    end
    @equations begin
        # Main loop
        connect(A, r123.frame_a)
        connect(r123.frame_b, b1.frame_b)
        connect(b1.frame_a, r2.frame_b)
        connect(r2.frame_a, D)

        # Spring damper
        if spring
            connect(springdamper.frame_b, spring_mount_E.frame_b)
            connect(b1.frame_a, spring_mount_F.frame_a)
            connect(D, spring_mount_E.frame_a)
            connect(springdamper.frame_a, spring_mount_F.frame_b)
        end

        connect(chassis_frame, chassis.frame_a)
    end
end

@mtkmodel ExcitedWheelAssembly begin
    @parameters begin
        rod_radius = 0.02
    end
    @components begin
        chassis_frame = Frame()
        suspension = QuarterCarSuspension(; rod_radius)

        wheel = SlippingWheel(
            radius = 0.2,
            m = 15,
            I_axis = 0.06,
            I_long = 0.12,
            x0 = 0.0,
            z0 = 0.0,
            der_angles = [0, 0, 0],
            iscut = true,
        )

    end
    @equations begin
        connect(wheel.frame_a, suspension.r123.frame_ib)
        connect(chassis_frame, suspension.chassis_frame)
    end
end


@mtkmodel SuspensionWithExcitationAndMass begin
    @parameters begin
        ms = 1500/4, [description = &quot;Mass of the car [kg]&quot;]
        rod_radius = 0.02
    end
    @components begin
        world = World()
        mass = Body(m=ms, r_cm = 0.5DA*normalize([0, 0.2, 0.2*sin(t5)]))
        excited_suspension = ExcitedWheelAssembly(; rod_radius)
        prescribed_motion = Pose(; r = [0, 0.1 + 0.1sin(t), 0], R = RotXYZ(0, 0.5sin(t), 0))
    end
    @equations begin
        connect(prescribed_motion.frame_b, excited_suspension.chassis_frame, mass.frame_a)
    end

end

@named model = SuspensionWithExcitationAndMass()
model = complete(model)
ssys = structural_simplify(multibody(model))
display([unknowns(ssys) diag(ssys.mass_matrix)])

defs = [
    model.excited_suspension.suspension.ks =&gt; 30*44000
    model.excited_suspension.suspension.cs =&gt; 30*4000
    model.excited_suspension.suspension.r2.phi =&gt; -0.6031*(1)
]
prob = ODEProblem(ssys, defs, (0, 2π))
sol = solve(prob, Rodas5P(autodiff=false), initializealg = BrownFullBasicInit())
@test SciMLBase.successful_retcode(sol)
Multibody.render(model, sol, show_axis=false, x=-0.8, y=0.7, z=0.1, lookat=[0,0.1,0.0], filename=&quot;prescribed_motion.gif&quot;) # Video</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Rosenbrock methods on equations without differential states do not bound the error on interpolations.
└ @ OrdinaryDiffEqCore ~/.julia/packages/OrdinaryDiffEqCore/55UVY/src/solve.jl:108</code></pre><p><img src="../prescribed_motion.gif" alt="prescribed motion"/></p><p>Even though we formulated an <code>ODEProblem</code> and called <code>solve</code>, we do not actually perform any simulation here! If we look at the mass matrix of the system</p><pre><code class="language-julia hljs">ssys.mass_matrix</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6×6 LinearAlgebra.Diagonal{Int64, Vector{Int64}}:
 0  ⋅  ⋅  ⋅  ⋅  ⋅
 ⋅  0  ⋅  ⋅  ⋅  ⋅
 ⋅  ⋅  0  ⋅  ⋅  ⋅
 ⋅  ⋅  ⋅  0  ⋅  ⋅
 ⋅  ⋅  ⋅  ⋅  0  ⋅
 ⋅  ⋅  ⋅  ⋅  ⋅  0</code></pre><p>we see that it is all zeros. This means that there are no differential equations at all in the system, only algebraic equations. The solver will thus only solve for the algebraic variables using a nonlinear root finder. In general, prescribing the value of some state variables removes the need for the solver to solve for them, which can be useful for simplifying simulations. Using the &quot;simulation&quot; above, we can use the solution object to, e.g., find the compression of the spring and the forces acting on the ground over time.</p><pre><code class="language-julia hljs">plot(sol, idxs=[model.excited_suspension.suspension.springdamper.s, -model.excited_suspension.suspension.springdamper.f, model.excited_suspension.wheel.wheeljoint.f_n], labels=[&quot;Spring length [m]&quot; &quot;Spring force [N] &quot; &quot;Normal force [N]&quot;], layout=(2,1), sp=[1 2 2])</code></pre><img src="edf92010.svg" alt="Example block output"/><p>Here, we see that the total spring force and the normal force acting on the ground are not equal, this is due to the spring not applying force only in the vertical direction. We can also compute the slip velocity, the velocity with which the contact between the wheel and the ground is sliding along the ground due to the prescribed motion.</p><pre><code class="language-julia hljs">wj = model.excited_suspension.wheel.wheeljoint
plot(sol, idxs=[wj.v_slip, wj.v_slip_long, wj.v_slip_lat], labels=[&quot;Slip velocity magnitude&quot; &quot;Longitudinal slip velocity&quot; &quot;Lateral slip velocity&quot;], ylabel=&quot;Velocity [m/s]&quot;)</code></pre><img src="cbe31a2c.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../free_motion/">« Free motions</a><a class="docs-footer-nextpage" href="../kinematic_loops/">Kinematic loops »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 7 October 2024 14:31">Monday 7 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
